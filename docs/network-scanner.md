# Сетевой сканер устройств

## Описание

Система мониторинга теперь поддерживает автоматическое сканирование сети для обнаружения новых устройств с помощью nmap.

## Возможности

- **Автоматическое обнаружение устройств** в указанной сети
- **Получение MAC адресов** и информации о производителе
- **Фильтрация существующих устройств** - показываются только новые
- **Массовое добавление** выбранных устройств
- **Интеграция с папками** - устройства добавляются в выбранную папку

## Установка nmap

### Windows

1. Скачайте nmap с официального сайта: https://nmap.org/download.html
2. Установите скачанный файл
3. Добавьте nmap в PATH или укажите полный путь в переменной окружения

### macOS

```bash
brew install nmap
```

### Linux (Ubuntu/Debian)

```bash
sudo apt update
sudo apt install nmap
```

### Linux (CentOS/RHEL)

```bash
sudo yum install nmap
# или для новых версий
sudo dnf install nmap
```

### Docker

Nmap уже включен в Docker образ backend.

## Использование

### Через веб-интерфейс

1. **В списке устройств**: Нажмите кнопку "Сканировать сеть"
2. **При добавлении устройства**: Нажмите кнопку "Сканировать" рядом с полем IP

### Через API

#### Сканирование сети

```bash
POST /api/devices/scan-network
Content-Type: application/json

{
  "network": "192.168.1.0/24",
  "timeout": 10000
}
```

#### Массовое создание устройств

```bash
POST /api/devices/bulk-create
Content-Type: application/json

{
  "devices": [
    {
      "name": "Device 192.168.1.100",
      "ip": "192.168.1.100",
      "mac": "00:1B:44:11:3A:B7",
      "type": "workstation",
      "vendor": "Cisco",
      "folderId": "folder-id"
    }
  ],
  "folderId": "default-folder-id"
}
```

## Примеры сетей

- `192.168.1.0/24` - 254 устройства (192.168.1.1 - 192.168.1.254)
- `10.0.0.0/16` - 65534 устройства (10.0.0.1 - 10.0.255.254)
- `172.16.0.0/12` - 1048574 устройства (172.16.0.1 - 172.31.255.254)

## Безопасность

⚠️ **Важно**: Сканирование сети может быть обнаружено системами безопасности. Используйте только в доверенных сетях.

### Рекомендации:

- Получите разрешение администратора сети
- Сканируйте только свои сети
- Не используйте агрессивные методы сканирования
- Учитывайте политики безопасности организации

## Настройка

### Переменные окружения

```env
# Таймаут сканирования по умолчанию (мс)
NETWORK_SCAN_TIMEOUT=10000

# Максимальное количество устройств за одно сканирование
MAX_SCAN_DEVICES=1000

# Путь к nmap (если не в PATH)
NMAP_PATH=/usr/bin/nmap
```

### Ограничения

- Максимальное время сканирования: 60 секунд
- Максимальное количество устройств: 1000
- Поддерживаемые форматы сети: CIDR (например, 192.168.1.0/24)

## Устранение неполадок

### Ошибка "Nmap не установлен"

1. Убедитесь, что nmap установлен
2. Проверьте, что nmap доступен в PATH
3. Для Windows: перезапустите терминал после установки

### Сканирование не находит устройства

1. Проверьте правильность адреса сети
2. Убедитесь, что устройства включены и доступны
3. Проверьте настройки файрвола
4. Попробуйте уменьшить размер сети (например, /25 вместо /24)

### Медленное сканирование

1. Уменьшите размер сети
2. Увеличьте таймаут
3. Проверьте загрузку сети

## Логирование

Сканирование логируется в:

- `logs/monitoring.log` - результаты сканирования
- `logs/api.log` - API запросы
- `logs/error.log` - ошибки

## Разработка

### Добавление новых методов сканирования

1. Создайте новый контроллер в `src/controllers/`
2. Добавьте маршрут в `src/routes/devices.ts`
3. Обновите фронтенд компоненты

### Тестирование

```bash
# Тест сканирования
curl -X POST http://localhost:5000/api/devices/scan-network \
  -H "Content-Type: application/json" \
  -d '{"network": "127.0.0.1/32"}'
```

## Лицензия

Nmap распространяется под лицензией GPL v2. Убедитесь, что вы соблюдаете условия лицензии при использовании.


